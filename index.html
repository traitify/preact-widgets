<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Traitify Widgets</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  </head>
  <body>
    <div id="slide-deck"></div>
    <div id="careers"></div>
    <div id="results"></div>
    <script src="/build/traitify.js"></script>
    <script>
      Traitify.setPublicKey("sptoechv411aqbqrp4l9a4eg2a");
      Traitify.setHost("https://api.traitify.com");

      function createWidget(){
        Traitify.ui.on("CareerModal.updated", function(context){
          if(!context.customContent){ return; }
          context.customContent.appendChild(document.createTextNode("I am custom content"));
        });

        var widget = Traitify.ui.component();
        widget.locale(localStorage.getItem("locale") || "en-us").assessmentID(localStorage.getItem("assessment-id"));
        widget
          .allowBack()
          .allowFullscreen()
          .perspective("firstPerson")
          .targets({
            "SlideDeck": "#slide-deck",
            "Careers": "#careers",
            "Results": "#results"
          });
        widget.render().then(function(){
          console.log("Rendered");
        }).catch(function(error){
          console.log(error);
        });
      }

      function createAssessment(){
        Traitify.post("/assessments", {
          deck_id: document.querySelector("#deck-name").value,
          locale_key: "en-us",
          package_id: "cfc05114-b8af-43fb-af27-c175e0cc25ee"
        }).then(function(assessment){
          try{
            localStorage.setItem("assessment-id", assessment.id);
          }catch(error){
            console.log(error);
          }
          createWidget();
        });
      }

      function changeLocale(){
        Traitify.ui.setLocale(document.querySelector("#locale").value);
        localStorage.setItem("locale", document.querySelector("#locale").value);
      }

      if(localStorage.getItem("assessment-id")){
        createWidget();
      }
    </script>

    <br/>
    <br/>
    <select id="deck-name">
      <option value="big-five">Big Five</option>
      <option value="career-deck">Career Deck</option>
      <option value="perseverance">Perseverance</option>
      <option value="persuasion">Persuasion</option>
    </select>

    <button onclick="createAssessment()">New Assessment</button>
    <br/>
    <br/>
    <select id="locale">
      <option value="ht-us">Creole</option>
      <option value="nl-nl">Dutch</option>
      <option value="en-us" selected>English</option>
      <option value="en-gb">English (GB)</option>
      <option value="fr-ca">French (Canadian)</option>
      <option value="fr-fr">French (France)</option>
      <option value="no-no">Norwegian</option>
      <option value="es-us">Spanish</option>
      <option value="sv-se">Swedish</option>
    </select>

    <button onclick="changeLocale()">Change Locale</button>
  </body>
</html>
