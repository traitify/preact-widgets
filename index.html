<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Traitify Widgets</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  </head>
  <body>
    <div id="widgets"></div>
    <script src="/build/bundle.js"></script>
    <script>
      Traitify.setPublicKey("sptoechv411aqbqrp4l9a4eg2a");
      Traitify.setHost("https://api.traitify.com");

      initDeck = function(){
        var assessment = Traitify.ui.assessmentId(localStorage.getItem("assessment-id"));
        assessment.target("#widgets");
        assessment.perspective("firstPerson")
        assessment.on("personalitytypes.initialized", (me)=>{
          window.me = me;
        })
        widget = assessment.render()
        widget.catch(function(error){
          console.log(error)
        });
      }

      createAssessment = function(){
        Traitify.post("/assessments", {deck_id: document.querySelector("#deck-name").value, locale_key: "en-us"}).then(function(assessment){
          localStorage.setItem("assessment-id", assessment.id);
          initDeck();
        })
      }

      if(localStorage.getItem("assessment-id")){
        initDeck();
      }
    </script>

    <select id="deck-name">
      <option value="career-deck">Career Deck</option>
      <option value="big-five-classic">The Big Five</option>
    </select>

    <button onclick="createAssessment()">New Assessment</button>
  </body>
</html>
